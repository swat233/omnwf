<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Will you be my Valentine? üíï</title>
  
  <!-- Confetti library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script> 
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Righteous&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-primary: #ffb3d9;
      --bg-secondary: #ffe6f7;
      --bg-accent: #ff99cc;
      --card-bg: #ffffffee;
      --yes-primary: #ff1744;
      --yes-hover: #d50032;
      --yes-glow: rgba(255, 23, 68, 0.4);
      --no-bg: #f5f5f5;
      --no-hover: #eeeeee;
      --text-dark: #1a1a1a;
      --text-light: #ffffff;
      --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
      --shadow-md: 0 10px 30px rgba(0, 0, 0, 0.12);
      --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.15);
    }

    body.dark-mode {
      --bg-primary: #2d1b3d;
      --bg-secondary: #1a0f2e;
      --bg-accent: #4a2b5c;
      --card-bg: #2a1f3dee;
      --text-dark: #ffffff;
      --no-bg: #3d2f4d;
      --no-hover: #4d3f5d;
    }

    body.purple-theme {
      --bg-primary: #dbb5ff;
      --bg-secondary: #f3e6ff;
      --bg-accent: #c799ff;
      --yes-primary: #9c27b0;
      --yes-hover: #7b1fa2;
      --yes-glow: rgba(156, 39, 176, 0.4);
    }

    body.red-theme {
      --bg-primary: #ffcdd2;
      --bg-secondary: #ffebee;
      --bg-accent: #ef9a9a;
      --yes-primary: #d32f2f;
      --yes-hover: #b71c1c;
      --yes-glow: rgba(211, 47, 47, 0.4);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100svh;
      display: grid;
      place-items: center;
      background: 
        radial-gradient(circle at 20% 80%, var(--bg-accent) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, var(--bg-accent) 0%, transparent 50%),
        linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
      font-family: 'Quicksand', system-ui, sans-serif;
      overflow: hidden;
      padding: 20px;
      position: relative;
    }

    /* Floating hearts background */
    body::before {
      content: 'üíï üíñ üíó üíì üíù ‚ù§Ô∏è üíï üíñ üíó';
      position: fixed;
      top: -100%;
      left: 0;
      width: 100%;
      height: 200%;
      font-size: 40px;
      opacity: 0.1;
      pointer-events: none;
      animation: floatHearts 30s linear infinite;
      z-index: 0;
    }

    @keyframes floatHearts {
      to {
        transform: translateY(100%);
      }
    }

    /* Theme and audio controls */
    .controls {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 1000;
    }

    .control-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: none;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      cursor: pointer;
      font-size: 20px;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .control-btn:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-md);
    }

    .control-btn:active {
      transform: scale(0.95);
    }

    /* Attempt counter */
    .counter {
      position: fixed;
      top: 20px;
      left: 20px;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      padding: 12px 20px;
      border-radius: 20px;
      font-weight: 700;
      color: var(--text-dark);
      box-shadow: var(--shadow-sm);
      z-index: 1000;
      font-size: 14px;
    }

    /* Sparkle effect */
    .sparkle {
      position: absolute;
      pointer-events: none;
      font-size: 20px;
      animation: sparkleFloat 1s ease-out forwards;
    }

    @keyframes sparkleFloat {
      0% {
        transform: translate(0, 0) scale(0);
        opacity: 1;
      }
      100% {
        transform: translate(var(--tx), var(--ty)) scale(1);
        opacity: 0;
      }
    }

    /* Trail effect for No button */
    .trail {
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: radial-gradient(circle, var(--yes-primary), transparent);
      pointer-events: none;
      animation: trailFade 0.6s ease-out forwards;
    }

    @keyframes trailFade {
      to {
        transform: scale(2);
        opacity: 0;
      }
    }

    /* Give up button */
    #giveUpBtn {
      display: none;
      margin-top: 20px;
      padding: 12px 24px;
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      color: #1a1a1a;
      border: none;
      border-radius: 20px;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      box-shadow: var(--shadow-md);
      animation: bounce 0.5s ease-in-out;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    #giveUpBtn:hover {
      background: linear-gradient(135deg, #ffed4e, #ffd700);
      transform: scale(1.05);
    }

    /* Full-screen confetti canvas */
    #confettiCanvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 9999;
    }

    .card {
      width: min(720px, 95vw);
      padding: clamp(24px, 5vw, 48px);
      background: var(--card-bg);
      backdrop-filter: blur(20px) saturate(180%);
      border-radius: 32px;
      text-align: center;
      box-shadow: var(--shadow-lg);
      position: relative;
      z-index: 1;
      animation: cardEntrance 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      border: 2px solid rgba(255, 255, 255, 0.5);
    }

    @keyframes cardEntrance {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .art {
      width: min(280px, 85vw);
      margin: 0 auto 20px;
      display: block;
      filter: drop-shadow(0 12px 20px rgba(0, 0, 0, 0.15));
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-12px);
      }
    }

    h1 {
      font-family: 'Righteous', cursive;
      font-size: clamp(28px, 5vw, 52px);
      margin: 20px 0 30px;
      color: var(--text-dark);
      text-shadow: 2px 2px 0 rgba(255, 255, 255, 0.5);
      letter-spacing: -0.5px;
      line-height: 1.2;
    }

    .button-zone {
      position: relative;
      width: min(560px, 100%);
      height: 160px;
      margin: 20px auto;
      touch-action: none;
    }

    button {
      position: absolute;
      top: 50%;
      padding: 18px 36px;
      font-size: clamp(16px, 3vw, 20px);
      font-weight: 700;
      font-family: 'Quicksand', sans-serif;
      border-radius: 50px;
      border: none;
      cursor: pointer;
      box-shadow: var(--shadow-md);
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      transform-origin: center;
    }

    button:active {
      transform: translateY(-50%) scale(0.96) !important;
    }

    #yesBtn {
      left: 15%;
      transform: translateY(-50%);
      background: linear-gradient(135deg, var(--yes-primary) 0%, #ff4569 100%);
      color: var(--text-light);
      position: relative;
      overflow: hidden;
      animation: heartbeat 1s ease-in-out infinite;
    }

    @keyframes heartbeat {
      0%, 100% {
        transform: translateY(-50%) scale(1);
      }
      25% {
        transform: translateY(-50%) scale(1.05);
      }
      50% {
        transform: translateY(-50%) scale(1);
      }
      75% {
        transform: translateY(-50%) scale(1.05);
      }
    }

    #yesBtn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    #yesBtn:hover::before {
      width: 300px;
      height: 300px;
    }

    #yesBtn:hover {
      background: linear-gradient(135deg, var(--yes-hover) 0%, #ff1744 100%);
      box-shadow: 0 12px 35px var(--yes-glow), 0 0 40px var(--yes-glow);
      transform: translateY(-50%) scale(1.05);
    }

    #noBtn {
      left: 60%;
      transform: translateY(-50%);
      background: var(--no-bg);
      color: var(--text-dark);
    }

    #noBtn:hover {
      background: var(--no-hover);
    }

    .hint {
      margin-top: 16px;
      font-size: clamp(12px, 2.5vw, 15px);
      color: var(--text-dark);
      opacity: 0.7;
      font-style: italic;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 0.7;
      }
      50% {
        opacity: 0.4;
      }
    }

    .result {
      display: none;
      margin-top: 24px;
      animation: resultAppear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes resultAppear {
      from {
        transform: scale(0.8) rotate(-5deg);
        opacity: 0;
      }
      to {
        transform: scale(1) rotate(0deg);
        opacity: 1;
      }
    }

    .result h2 {
      font-family: 'Righteous', cursive;
      font-size: clamp(36px, 6vw, 56px);
      margin: 16px 0;
      color: var(--yes-primary);
      text-shadow: 2px 2px 0 rgba(255, 255, 255, 0.8);
      animation: celebrate 0.6s ease-in-out;
    }

    @keyframes celebrate {
      0%, 100% {
        transform: scale(1) rotate(0deg);
      }
      25% {
        transform: scale(1.1) rotate(-5deg);
      }
      75% {
        transform: scale(1.1) rotate(5deg);
      }
    }

    .fireworks {
      width: min(400px, 92vw);
      margin: 16px auto;
      display: block;
      border-radius: 20px;
      box-shadow: var(--shadow-md);
    }

    .result-message {
      font-size: clamp(16px, 3vw, 20px);
      color: var(--text-dark);
      margin: 16px 0;
      font-weight: 600;
      line-height: 1.5;
    }

    /* Accessibility improvements */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Mobile optimizations */
    @media (max-width: 640px) {
      .button-zone {
        height: 180px;
      }
      
      #yesBtn {
        left: 10%;
      }
      
      #noBtn {
        left: 55%;
      }
    }

    /* Focus styles for keyboard navigation */
    button:focus-visible {
      outline: 3px solid var(--yes-primary);
      outline-offset: 4px;
    }
  </style>
</head>

<body>
  <canvas id="confettiCanvas" aria-hidden="true"></canvas>

  <!-- Controls -->
  <div class="controls">
    <button class="control-btn" id="themeBtn" title="Change theme">üé®</button>
    <button class="control-btn" id="darkModeBtn" title="Toggle dark mode">üåô</button>
    <button class="control-btn" id="musicBtn" title="Toggle music">üéµ</button>
  </div>

  <!-- Attempt Counter -->
  <div class="counter" id="counter">
    No attempts: 0 üòè
  </div>

  <main class="card" role="main">
    <!-- Animated cute animal with heart -->
    <svg class="art" viewBox="0 0 320 240" xmlns="http://www.w3.org/2000/svg" aria-label="Cute animal holding a heart">
      <defs>
        <linearGradient id="fur" x1="0" x2="1" y1="0" y2="1">
          <stop offset="0%" stop-color="#ffd4a8"/>
          <stop offset="100%" stop-color="#ffb380"/>
        </linearGradient>
        <linearGradient id="heart" x1="0" x2="1" y1="0" y2="1">
          <stop offset="0%" stop-color="#ff5983"/>
          <stop offset="100%" stop-color="#ff1744"/>
        </linearGradient>
        <filter id="glow">
          <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      <!-- Floating heart -->
      <path d="M250 50 C250 33 270 25 282 38
               C294 25 314 33 314 50
               C314 78 282 92 282 106
               C282 92 250 78 250 50Z"
            fill="url(#heart)" filter="url(#glow)">
        <animateTransform
          attributeName="transform"
          type="translate"
          values="0 0; 0 -8; 0 0"
          dur="2s"
          repeatCount="indefinite"/>
      </path>

      <!-- Animal body -->
      <path d="M90 120 C90 70 140 40 190 60
               C240 40 290 70 290 120
               C290 180 240 210 190 210
               C140 210 90 180 90 120Z"
            fill="url(#fur)"/>

      <!-- Ears -->
      <path d="M110 92 L95 55 L140 78 Z" fill="#ffb380">
        <animateTransform
          attributeName="transform"
          type="rotate"
          values="0 110 92; -5 110 92; 0 110 92"
          dur="3s"
          repeatCount="indefinite"/>
      </path>
      <path d="M270 92 L285 55 L240 78 Z" fill="#ffb380">
        <animateTransform
          attributeName="transform"
          type="rotate"
          values="0 270 92; 5 270 92; 0 270 92"
          dur="3s"
          repeatCount="indefinite"/>
      </path>

      <!-- Eyes -->
      <circle cx="160" cy="130" r="8" fill="#1a1a1a">
        <animate attributeName="r" values="8;2;8" dur="3s" repeatCount="indefinite"/>
      </circle>
      <circle cx="220" cy="130" r="8" fill="#1a1a1a">
        <animate attributeName="r" values="8;2;8" dur="3s" repeatCount="indefinite"/>
      </circle>

      <!-- Nose/snout -->
      <path d="M190 144 C186 144 182 148 182 152
               C182 160 190 164 190 170
               C190 164 198 160 198 152
               C198 148 194 144 190 144Z"
            fill="#ff8fab"/>
    </svg>

    <h1 id="mainQuestion">Morgan, will you be my Valentine?</h1>

    <section class="button-zone" id="zone" aria-label="Response buttons">
      <button id="yesBtn" aria-label="Yes, I will be your Valentine">
        <span>Yes! üíï</span>
      </button>
      <button id="noBtn" aria-label="No, I won't be your Valentine">
        <span>No</span>
      </button>
    </section>

    <div class="hint" id="hint" aria-live="polite">
      Try clicking "No"... I dare you üòà
    </div>

    <button id="giveUpBtn">Fine, I give up... üòÖ</button>

    <section class="result" id="result" role="alert" aria-live="assertive">
      <h2>YAY! üéâüíñüéä</h2>
      <p class="result-message" id="resultMessage">
        I knew you'd say yes! Get ready for the best Valentine's Day ever! üíï
      </p>
      <img
        class="fireworks"
        src="https://media.tenor.com/x8v1oNUOmg4AAAAd/rick-astley-roll.gif"
        alt="Happy celebration"
      />
    </section>
  </main>

  <script>
    'use strict';

    // DOM elements
    const zone = document.getElementById('zone');
    const yesBtn = document.getElementById('yesBtn');
    const noBtn = document.getElementById('noBtn');
    const result = document.getElementById('result');
    const hint = document.getElementById('hint');
    const confettiCanvas = document.getElementById('confettiCanvas');
    const mainQuestion = document.getElementById('mainQuestion');
    const counter = document.getElementById('counter');
    const giveUpBtn = document.getElementById('giveUpBtn');
    const themeBtn = document.getElementById('themeBtn');
    const darkModeBtn = document.getElementById('darkModeBtn');
    const musicBtn = document.getElementById('musicBtn');
    const resultMessage = document.getElementById('resultMessage');

    // State
    let yesScale = 1;
    let noScale = 1;
    const MAX_YES_SCALE = 2.4;
    const YES_SCALE_INCREMENT = 0.12;
    const NO_SCALE_DECREMENT = 0.08;
    const MIN_NO_SCALE = 0.4;
    const NO_ESCAPE_RADIUS = 150;
    let NO_PUSH_DISTANCE = 160;
    let dodgeCount = 0;
    let noAttempts = 0;
    let currentTheme = 0;
    const themes = ['', 'purple-theme', 'red-theme'];
    let isDarkMode = false;
    let musicPlaying = false;
    let audioContext;
    let musicGain;
    let musicOscillators = [];

    // Teasing hint messages
    const teasingHints = [
      "Try clicking 'No'... I dare you üòà",
      "The 'No' button seems shy today üôà",
      "Oops! It ran away again üòè",
      "You sure about that? ü§î",
      "Come on, you know you want to say yes üíï",
      "The 'No' button is playing hard to get üòú",
      "Still trying? How adorable ü•∞",
      "Just say yes already! üíñ",
      "The 'Yes' button is getting lonely ü•∫",
      "I think the universe is trying to tell you something ‚ú®",
      "Notice how 'Yes' is getting bigger? üëÄ",
      "And 'No' is getting smaller... interesting ü§è",
      "Maybe it's a sign? üí´",
      "Your resistance is... cute but futile üòò"
    ];

    /* ========== URL PERSONALIZATION ========== */
    function personalizeQuestion() {
      const urlParams = new URLSearchParams(window.location.search);
      const name = urlParams.get('name');
      if (name) {
        mainQuestion.textContent = `${name}, will you be my Valentine?`;
      }
      // If no URL parameter, Morgan stays as the default from HTML
    }
    personalizeQuestion();

    /* ========== THEME CONTROLS ========== */
    themeBtn.addEventListener('click', () => {
      currentTheme = (currentTheme + 1) % themes.length;
      document.body.className = themes[currentTheme] + (isDarkMode ? ' dark-mode' : '');
      vibrate([30]);
    });

    darkModeBtn.addEventListener('click', () => {
      isDarkMode = !isDarkMode;
      document.body.classList.toggle('dark-mode');
      darkModeBtn.textContent = isDarkMode ? '‚òÄÔ∏è' : 'üåô';
      vibrate([30]);
    });

    /* ========== BACKGROUND MUSIC ========== */
    function initAudio() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        musicGain = audioContext.createGain();
        musicGain.connect(audioContext.destination);
        musicGain.gain.value = 0.15;
      }
    }

    function startMusic() {
      initAudio();
      if (musicOscillators.length > 0) return;

      // Simple romantic melody
      const melody = [
        {freq: 523.25, time: 0},    // C5
        {freq: 587.33, time: 0.5},  // D5
        {freq: 659.25, time: 1},    // E5
        {freq: 523.25, time: 1.5},  // C5
        {freq: 698.46, time: 2},    // F5
        {freq: 659.25, time: 2.5},  // E5
        {freq: 587.33, time: 3},    // D5
        {freq: 523.25, time: 3.5},  // C5
      ];

      function playLoop() {
        melody.forEach(note => {
          const osc = audioContext.createOscillator();
          osc.type = 'sine';
          osc.frequency.value = note.freq;
          osc.connect(musicGain);
          osc.start(audioContext.currentTime + note.time);
          osc.stop(audioContext.currentTime + note.time + 0.4);
        });
        setTimeout(playLoop, 4000);
      }

      playLoop();
      musicPlaying = true;
      musicBtn.textContent = 'üîá';
    }

    function stopMusic() {
      if (musicGain) {
        musicGain.gain.setValueAtTime(musicGain.gain.value, audioContext.currentTime);
        musicGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      }
      musicPlaying = false;
      musicBtn.textContent = 'üéµ';
    }

    musicBtn.addEventListener('click', () => {
      if (musicPlaying) {
        stopMusic();
      } else {
        startMusic();
      }
      vibrate([30]);
    });

    /* ========== HAPTIC FEEDBACK ========== */
    function vibrate(pattern) {
      if ('vibrate' in navigator) {
        navigator.vibrate(pattern);
      }
    }

    /* ========== SOUND EFFECTS ========== */
    function playPopSound() {
      initAudio();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
      oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.1);
    }

    function playAwwSound() {
      initAudio();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
      oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.3);
      
      gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.3);
    }

    function playHeartbeat() {
      initAudio();
      [0, 0.15].forEach(delay => {
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);
        osc.frequency.value = 80;
        gain.gain.setValueAtTime(0.3, audioContext.currentTime + delay);
        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + delay + 0.1);
        osc.start(audioContext.currentTime + delay);
        osc.stop(audioContext.currentTime + delay + 0.1);
      });
    }

    /* ========== VISUAL EFFECTS ========== */
    function createSparkle(x, y) {
      const sparkles = ['‚ú®', 'üíñ', 'üíï', '‚≠ê', 'üåü'];
      const sparkle = document.createElement('div');
      sparkle.className = 'sparkle';
      sparkle.textContent = sparkles[Math.floor(Math.random() * sparkles.length)];
      sparkle.style.left = x + 'px';
      sparkle.style.top = y + 'px';
      sparkle.style.setProperty('--tx', (Math.random() - 0.5) * 100 + 'px');
      sparkle.style.setProperty('--ty', (Math.random() - 0.5) * 100 + 'px');
      document.body.appendChild(sparkle);
      setTimeout(() => sparkle.remove(), 1000);
    }

    function createTrail(x, y) {
      const trail = document.createElement('div');
      trail.className = 'trail';
      trail.style.left = x + 'px';
      trail.style.top = y + 'px';
      document.body.appendChild(trail);
      setTimeout(() => trail.remove(), 600);
    }

    /* ========== CONFETTI SETUP ========== */
    function resizeConfettiCanvas() {
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      confettiCanvas.width = Math.floor(window.innerWidth * dpr);
      confettiCanvas.height = Math.floor(window.innerHeight * dpr);
    }

    resizeConfettiCanvas();
    window.addEventListener('resize', resizeConfettiCanvas);
    window.addEventListener('orientationchange', () => {
      setTimeout(resizeConfettiCanvas, 200);
    });

    const confettiInstance = confetti.create(confettiCanvas, {
      resize: false,
      useWorker: true
    });

    function launchConfetti() {
      const duration = 3000;
      const end = Date.now() + duration;

      // Heart-shaped confetti
      const heartShape = confetti.shapeFromText({ text: 'üíï', scalar: 2 });

      (function frame() {
        confettiInstance({
          particleCount: 15,
          spread: 100,
          startVelocity: 50,
          decay: 0.92,
          scalar: 1.2,
          shapes: [heartShape, 'circle', 'square'],
          ticks: 200,
          origin: {
            x: Math.random(),
            y: Math.random() * 0.4
          },
          colors: ['#ff1744', '#ff4569', '#ff8fab', '#ffd4a8', '#ffb3d9', '#ffd700']
        });

        if (Date.now() < end) {
          requestAnimationFrame(frame);
        }
      })();

      // Multiple big bursts
      [300, 800, 1500].forEach(delay => {
        setTimeout(() => {
          confettiInstance({
            particleCount: 250,
            spread: 160,
            startVelocity: 65,
            decay: 0.9,
            scalar: 1.3,
            shapes: [heartShape, 'circle'],
            ticks: 250,
            origin: { x: 0.5, y: 0.5 },
            colors: ['#ff1744', '#ff4569', '#ff8fab', '#ffd4a8', '#ffb3d9', '#ffd700']
          });
        }, delay);
      });
    }

    /* ========== YES BUTTON GROWTH & FASTER HEARTBEAT ========== */
    function growYesButton() {
      yesScale = Math.min(MAX_YES_SCALE, yesScale + YES_SCALE_INCREMENT);
      yesBtn.style.transform = `translateY(-50%) scale(${yesScale})`;
      
      // Make heartbeat faster as button grows
      const heartbeatSpeed = Math.max(0.3, 1 - (yesScale - 1) / 2);
      yesBtn.style.animationDuration = `${heartbeatSpeed}s`;

      // Sparkles around Yes button
      const rect = yesBtn.getBoundingClientRect();
      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          createSparkle(
            rect.left + rect.width * Math.random(),
            rect.top + rect.height * Math.random()
          );
        }, i * 100);
      }

      // Play heartbeat sound
      if (yesScale > 1.5) {
        playHeartbeat();
      }
    }

    /* ========== NO BUTTON SHRINKING ========== */
    function shrinkNoButton() {
      noScale = Math.max(MIN_NO_SCALE, noScale - NO_SCALE_DECREMENT);
      noBtn.style.transform = `translateY(-50%) scale(${noScale})`;
    }

    /* ========== NO BUTTON ESCAPE LOGIC ========== */
    function clamp(value, min, max) {
      return Math.max(min, Math.min(max, value));
    }

    function updateCounter() {
      noAttempts++;
      counter.textContent = `No attempts: ${noAttempts} üòè`;
      
      // Show give up button after 10 attempts
      if (noAttempts >= 10) {
        giveUpBtn.style.display = 'block';
      }

      // Make No button faster after each attempt
      NO_PUSH_DISTANCE = Math.min(250, 160 + noAttempts * 5);
    }

    function updateHint() {
      dodgeCount++;
      if (dodgeCount < teasingHints.length) {
        hint.textContent = teasingHints[dodgeCount];
      } else {
        hint.textContent = teasingHints[Math.floor(Math.random() * teasingHints.length)];
      }
    }

    function moveNoButton(pointerX, pointerY) {
      const zoneRect = zone.getBoundingClientRect();
      const btnRect = noBtn.getBoundingClientRect();

      const btnCenterX = btnRect.left + btnRect.width / 2;
      const btnCenterY = btnRect.top + btnRect.height / 2;
      const distance = Math.hypot(btnCenterX - pointerX, btnCenterY - pointerY);

      if (distance >= NO_ESCAPE_RADIUS) return;

      // Haptic feedback and trail
      vibrate([30]);
      createTrail(btnCenterX, btnCenterY);

      // Calculate escape direction
      let dx = btnCenterX - pointerX;
      let dy = btnCenterY - pointerY;
      const magnitude = Math.hypot(dx, dy) || 1;
      dx /= magnitude;
      dy /= magnitude;

      const currentLeft = btnRect.left - zoneRect.left;
      const currentTop = btnRect.top - zoneRect.top;
      
      let newLeft = currentLeft + dx * NO_PUSH_DISTANCE;
      let newTop = currentTop + dy * NO_PUSH_DISTANCE;

      newLeft = clamp(newLeft, 0, zoneRect.width - btnRect.width);
      newTop = clamp(newTop, 0, zoneRect.height - btnRect.height);

      noBtn.style.left = `${newLeft}px`;
      noBtn.style.top = `${newTop}px`;
      noBtn.style.transform = `scale(${noScale})`;

      growYesButton();
      shrinkNoButton();
      updateHint();
    }

    /* ========== SUCCESS FUNCTIONS ========== */
    function showSuccess() {
      // Personalized message
      const urlParams = new URLSearchParams(window.location.search);
      const name = urlParams.get('name') || 'Morgan'; // Default to Morgan if no URL param
      const messages = [
        `I knew you'd say yes! Get ready for the best Valentine's Day ever! üíï`,
        `YES! I'm so excited! This is going to be amazing! üéâ`,
        `You made the right choice! Can't wait to celebrate with you! üíñ`,
        `I knew you couldn't resist! You're the best! ü•∞`
      ];
      resultMessage.textContent = `${name}, ${messages[Math.floor(Math.random() * messages.length)]}`;

      // Haptic feedback
      vibrate([100, 50, 100, 50, 200]);
      
      // Play pop sound
      playPopSound();
      
      // Hide interactive elements
      zone.style.display = 'none';
      hint.style.display = 'none';
      giveUpBtn.style.display = 'none';
      counter.style.display = 'none';
      
      // Show result
      result.style.display = 'block';
      
      // Launch confetti
      resizeConfettiCanvas();
      launchConfetti();
    }

    /* ========== EVENT LISTENERS ========== */
    
    // Track pointer movement
    zone.addEventListener('pointermove', (e) => {
      moveNoButton(e.clientX, e.clientY);
    });

    // Prevent no button from being clicked
    noBtn.addEventListener('click', (e) => {
      e.preventDefault();
      vibrate([50, 50, 50]);
      playAwwSound();
      
      updateCounter();
      growYesButton();
      shrinkNoButton();
      updateHint();
      
      // Shake animation
      noBtn.style.animation = 'none';
      setTimeout(() => {
        noBtn.style.animation = '';
      }, 10);
    });

    // Give up button
    giveUpBtn.addEventListener('click', () => {
      showSuccess();
    });

    // Handle yes button click
    yesBtn.addEventListener('click', () => {
      showSuccess();
    });

    // Keyboard accessibility
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && document.activeElement === yesBtn) {
        yesBtn.click();
      }
    });
  </script>
</body>
</html>
